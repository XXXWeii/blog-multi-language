(window.webpackJsonp=window.webpackJsonp||[]).push([[121],{683:function(s,n,e){"use strict";e.r(n);var a=e(2),t=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"_0、前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_0、前言"}},[s._v("#")]),s._v(" 0、前言")]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("关于"),n("code",[s._v("promise、async/await")]),s._v("的使用相信很多小伙伴都比较熟悉了，但是提到"),n("strong",[s._v("事件循环机制输出结果")]),s._v("类似的题目，你敢说都会？")]),s._v(" "),n("p",[s._v("试一试？")]),s._v(" "),n("p",[s._v("🌰1：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function async1 () {\n    await new Promise((resolve, reject) => {\n        resolve()\n    })\n    console.log('A')\n}\n\nasync1()\n\nnew Promise((resolve) => {\n    console.log('B')\n    resolve()\n}).then(() => {\n    console.log('C')\n}).then(() => {\n    console.log('D')\n})\n\n// 最终结果👉: B A C D\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("🌰2：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function async1 () {\n    await async2()\n    console.log('A')\n}\n\nasync function async2 () {\n    return new Promise((resolve, reject) => {\n        resolve()\n    })\n}\n\nasync1()\n\nnew Promise((resolve) => {\n    console.log('B')\n    resolve()\n}).then(() => {\n    console.log('C')\n}).then(() => {\n    console.log('D')\n})\n\n// 最终结果👉: B C D A\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[s._v("❓ 基本一样的代码为什么会出现差别，话不多说 👇")]),s._v(" "),n("h2",{attrs:{id:"_1、async-函数返回值"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、async-函数返回值"}},[s._v("#")]),s._v(" 1、async 函数返回值")]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("在讨论 "),n("code",[s._v("await")]),s._v(" 之前，先聊一下 "),n("code",[s._v("async")]),s._v(" 函数处理返回值的问题，它会像 "),n("code",[s._v("Promise.prototype.then")]),s._v(" 一样，会对返回值的类型进行辨识。")]),s._v(" "),n("p",[s._v("👉"),n("strong",[s._v("根据返回值的类型，引起 "),n("code",[s._v("js引擎")]),s._v(" 对返回值处理方式的不同")])]),s._v(" "),n("blockquote",[n("p",[s._v("📑 结论："),n("code",[s._v("async")]),s._v("函数在抛出返回值时，会根据返回值"),n("strong",[s._v("类型")]),s._v("开启"),n("strong",[s._v("不同数目的微任务")])]),s._v(" "),n("ul",[n("li",[s._v("return 结果值：非"),n("code",[s._v("thenable")]),s._v("、非"),n("code",[s._v("promise")]),s._v("（不等待）")]),s._v(" "),n("li",[s._v("return 结果值："),n("code",[s._v("thenable")]),s._v("（等待 1 个"),n("code",[s._v("then")]),s._v("的时间）")]),s._v(" "),n("li",[s._v("return 结果值："),n("code",[s._v("promise")]),s._v("（等待 2 个"),n("code",[s._v("then")]),s._v("的时间）")])])]),s._v(" "),n("p",[s._v("🌰1：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function testA () {\n    return 1;\n}\n\ntestA().then(() => console.log(1));\nPromise.resolve()\n    .then(() => console.log(2))\n    .then(() => console.log(3));\n\n// (不等待)最终结果👉: 1 2 3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("🌰2：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function testB () {\n    return {\n        then (cb) {\n            cb();\n        }\n    };\n}\n\ntestB().then(() => console.log(1));\nPromise.resolve()\n    .then(() => console.log(2))\n    .then(() => console.log(3));\n\n// (等待一个then)最终结果👉: 2 1 3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("🌰3：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function testC () {\n    return new Promise((resolve, reject) => {\n        resolve()\n    })\n}\n\ntestC().then(() => console.log(1));\nPromise.resolve()\n    .then(() => console.log(2))\n    .then(() => console.log(3));\n\n// (等待两个then)最终结果👉: 2 3 1\n\n\n\n\nasync function testC () {\n    return new Promise((resolve, reject) => {\n        resolve()\n    })\n}\n\ntestC().then(() => console.log(1));\nPromise.resolve()\n    .then(() => console.log(2))\n    .then(() => console.log(3))\n    .then(() => console.log(4))\n\n// (等待两个then)最终结果👉: 2 3 1 4\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("看了这三个 🌰 是不是对"),n("code",[s._v("上面的结论")]),s._v("有了更深的认识？")]),s._v(" "),n("p",[s._v("稍安勿躁，来试试一个经典面试题 👇")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function async1 () {\n    console.log('1')\n    await async2()\n    console.log('AAA')\n}\n\nasync function async2 () {\n    console.log('3')\n    return new Promise((resolve, reject) => {\n        resolve()\n        console.log('4')\n    })\n}\n\nconsole.log('5')\n\nsetTimeout(() => {\n    console.log('6')\n}, 0);\n\nasync1()\n\nnew Promise((resolve) => {\n    console.log('7')\n    resolve()\n}).then(() => {\n    console.log('8')\n}).then(() => {\n    console.log('9')\n}).then(() => {\n    console.log('10')\n})\nconsole.log('11')\n\n// 最终结果👉: 5 1 3 4 7 11 8 9 AAA 10 6\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("p",[s._v("👀 做错了吧？")]),s._v(" "),n("p",[s._v("哈哈没关系")]),s._v(" "),n("blockquote",[n("p",[s._v("步骤拆分 👇：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("先执行同步代码，输出"),n("code",[s._v("5")])])]),s._v(" "),n("li",[n("p",[s._v("执行"),n("code",[s._v("setTimeout")]),s._v("，是放入宏任务异步队列中")])]),s._v(" "),n("li",[n("p",[s._v("接着执行"),n("code",[s._v("async1")]),s._v("函数，输出"),n("code",[s._v("1")])])]),s._v(" "),n("li",[n("p",[s._v("执行"),n("code",[s._v("async2")]),s._v("函数，输出"),n("code",[s._v("3")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("Promise")]),s._v("构造器中代码属于同步代码，输出"),n("code",[s._v("4")])]),s._v(" "),n("blockquote",[n("p",[n("code",[s._v("async2")]),s._v("函数的返回值是"),n("code",[s._v("Promise")]),s._v("，等待"),n("code",[s._v("2")]),s._v("个"),n("code",[s._v("then")]),s._v("后放行，所以"),n("code",[s._v("AAA")]),s._v("暂时无法输出")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("async1")]),s._v("函数"),n("strong",[s._v("暂时")]),s._v("结束，继续往下走，输出"),n("code",[s._v("7")])])]),s._v(" "),n("li",[n("p",[s._v("同步代码，输出"),n("code",[s._v("11")])])]),s._v(" "),n("li",[n("p",[s._v("执行第一个"),n("code",[s._v("then")]),s._v("，输出"),n("code",[s._v("8")])])]),s._v(" "),n("li",[n("p",[s._v("执行第二个"),n("code",[s._v("then")]),s._v("，输出"),n("code",[s._v("9")])])]),s._v(" "),n("li",[n("p",[s._v("终于"),n("strong",[s._v("等")]),s._v("到了两个"),n("code",[s._v("then")]),s._v("执行完毕，执行"),n("code",[s._v("async1")]),s._v("函数里面剩下的，输出"),n("code",[s._v("AAA")])])]),s._v(" "),n("li",[n("p",[s._v("再执行最后一个微任务"),n("code",[s._v("then")]),s._v("，输出"),n("code",[s._v("10")])])]),s._v(" "),n("li",[n("p",[s._v("执行最后的宏任务"),n("code",[s._v("setTimeout")]),s._v("，输出"),n("code",[s._v("6")])])])])]),s._v(" "),n("p",[s._v("❓ 是不是豁然开朗，欢迎点赞收藏！")]),s._v(" "),n("h2",{attrs:{id:"_2、await-右值类型区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、await-右值类型区别"}},[s._v("#")]),s._v(" 2、await 右值类型区别")]),s._v(" "),n("hr"),s._v(" "),n("h3",{attrs:{id:"_2-1、非-thenable"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1、非-thenable"}},[s._v("#")]),s._v(" 2.1、非 "),n("code",[s._v("thenable")])]),s._v(" "),n("p",[s._v("🌰1：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function test () {\n    console.log(1);\n    await 1;\n    console.log(2);\n}\n\ntest();\nconsole.log(3);\n// 最终结果👉: 1 3 2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("🌰2：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function func () {\n    console.log(2);\n}\n\nasync function test () {\n    console.log(1);\n    await func();\n    console.log(3);\n}\n\ntest();\nconsole.log(4);\n\n// 最终结果👉: 1 2 4 3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("🌰3：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function test () {\n    console.log(1);\n    await 123\n    console.log(2);\n}\n\ntest();\nconsole.log(3);\n\nPromise.resolve()\n    .then(() => console.log(4))\n    .then(() => console.log(5))\n    .then(() => console.log(6))\n    .then(() => console.log(7));\n\n// 最终结果👉: 1 3 2 4 5 6 7\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("blockquote",[n("p",[s._v("Note:")]),s._v(" "),n("p",[n("code",[s._v("await")]),s._v("后面接非 "),n("code",[s._v("thenable")]),s._v(" 类型，会立即向微任务队列添加一个微任务"),n("code",[s._v("then")]),s._v("，"),n("strong",[s._v("但不需等待")])])]),s._v(" "),n("h3",{attrs:{id:"_2-2、thenable类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2、thenable类型"}},[s._v("#")]),s._v(" 2.2、"),n("code",[s._v("thenable")]),s._v("类型")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function test () {\n    console.log(1);\n    await {\n        then (cb) {\n            cb();\n        },\n    };\n    console.log(2);\n}\n\ntest();\nconsole.log(3);\n\nPromise.resolve()\n    .then(() => console.log(4))\n    .then(() => console.log(5))\n    .then(() => console.log(6))\n    .then(() => console.log(7));\n\n// 最终结果👉: 1 3 4 2 5 6 7\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("blockquote",[n("p",[s._v("Note:")]),s._v(" "),n("p",[n("code",[s._v("await")]),s._v(" 后面接 "),n("code",[s._v("thenable")]),s._v(" 类型，需要"),n("strong",[s._v("等待一个 "),n("code",[s._v("then")]),s._v(" 的时间之后")]),s._v("执行")])]),s._v(" "),n("h3",{attrs:{id:"_2-3、promise类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3、promise类型"}},[s._v("#")]),s._v(" 2.3、"),n("code",[s._v("Promise")]),s._v("类型")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function test () {\n    console.log(1);\n    await new Promise((resolve, reject) => {\n        resolve()\n    })\n    console.log(2);\n}\n\ntest();\nconsole.log(3);\n\nPromise.resolve()\n    .then(() => console.log(4))\n    .then(() => console.log(5))\n    .then(() => console.log(6))\n    .then(() => console.log(7));\n\n// 最终结果👉: 1 3 2 4 5 6 7\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("❓ 为什么表现的和非 "),n("code",[s._v("thenable")]),s._v(" 值一样呢？为什么不等待两个 "),n("code",[s._v("then")]),s._v(" 的时间呢？")]),s._v(" "),n("blockquote",[n("p",[s._v("Note:")]),s._v(" "),n("ul",[n("li",[s._v("TC 39(ECMAScript 标准制定者) 对"),n("code",[s._v("await")]),s._v(" 后面是 "),n("code",[s._v("promise")]),s._v(" 的情况如何处理进行了一次修改，"),n("strong",[s._v("移除")]),s._v("了额外的两个微任务，在"),n("strong",[s._v("早期版本")]),s._v("，依然会等待两个 "),n("code",[s._v("then")]),s._v(" 的时间")]),s._v(" "),n("li",[s._v("有大佬翻译了官方解释："),n("strong",[s._v("更快的 async 函数和 promises")]),s._v("[1]，但在这次更新中并没有修改 "),n("code",[s._v("thenable")]),s._v(" 的情况")])])]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("这样做可以极大的优化 "),n("code",[s._v("await")]),s._v(" 等待的速度 👇")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function func () {\n    console.log(1);\n    await 1;\n    console.log(2);\n    await 2;\n    console.log(3);\n    await 3;\n    console.log(4);\n}\n\nasync function test () {\n    console.log(5);\n    await func();\n    console.log(6);\n}\n\ntest();\nconsole.log(7);\n\nPromise.resolve()\n    .then(() => console.log(8))\n    .then(() => console.log(9))\n    .then(() => console.log(10))\n    .then(() => console.log(11));\n\n// 最终结果👉: 5 1 7 2 8 3 9 4 10 6 11\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("blockquote",[n("p",[s._v("Note：")]),s._v(" "),n("p",[n("code",[s._v("await")]),s._v(" 和 "),n("code",[s._v("Promise.prototype.then")]),s._v(" 虽然很多时候可以在"),n("strong",[s._v("时间顺序")]),s._v("上能等效，但是它们之间有"),n("strong",[s._v("本质的区别")]),s._v("。")])]),s._v(" "),n("blockquote",[n("ul",[n("li",[n("code",[s._v("test")]),s._v(" 函数中的 "),n("code",[s._v("await")]),s._v(" 会等待 "),n("code",[s._v("func")]),s._v(" 函数中所有的 "),n("code",[s._v("await")]),s._v(" 取得 恢复函数执行 的命令并且整个函数执行完毕后才能获得取得 "),n("strong",[s._v("恢复函数执行")]),s._v("的命令；")]),s._v(" "),n("li",[s._v("也就是说，"),n("code",[s._v("func")]),s._v(" 函数的 "),n("code",[s._v("await")]),s._v(" 此时"),n("strong",[s._v("不能在时间的顺序上等效")]),s._v(" "),n("code",[s._v("then")]),s._v("，而要等待到 "),n("code",[s._v("test")]),s._v(" 函数完全执行完毕；")]),s._v(" "),n("li",[s._v("比如这里的数字"),n("code",[s._v("6")]),s._v("很晚才输出，"),n("strong",[s._v("如果")]),s._v("单纯看成"),n("code",[s._v("then")]),s._v("的话，在下一个微任务队列执行时"),n("code",[s._v("6")]),s._v("就应该作为同步代码输出了才对。")])])]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("所以我们可以合并两个函数的代码 👇")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function test () {\n    console.log(5);\n\n    console.log(1);\n    await 1;\n    console.log(2);\n    await 2;\n    console.log(3);\n    await 3;\n    console.log(4);\n    await null;\n\n    console.log(6);\n}\n\ntest();\nconsole.log(7);\n\nPromise.resolve()\n    .then(() => console.log(8))\n    .then(() => console.log(9))\n    .then(() => console.log(10))\n    .then(() => console.log(11));\n\n// 最终结果👉: 5 1 7 2 8 3 9 4 10 6 11\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("hr"),s._v(" "),n("p",[s._v("因为将原本的函数融合，此时的 "),n("code",[s._v("await")]),s._v(" 可以等效为 "),n("code",[s._v("Promise.prototype.then")]),s._v("，又完全可以等效如下代码 👇")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function test () {\n    console.log(5);\n    console.log(1);\n    Promise.resolve()\n        .then(() => console.log(2))\n        .then(() => console.log(3))\n        .then(() => console.log(4))\n        .then(() => console.log(6))\n}\n\ntest();\nconsole.log(7);\n\nPromise.resolve()\n    .then(() => console.log(8))\n    .then(() => console.log(9))\n    .then(() => console.log(10))\n    .then(() => console.log(11));\n\n// 最终结果👉: 5 1 7 2 8 3 9 4 10 6 11\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("hr"),s._v(" "),n("p",[s._v("以上三种写法在时间的顺序上完全等效，所以你 "),n("strong",[s._v("完全可以将 "),n("code",[s._v("await")]),s._v(" 后面的代码可以看做在 "),n("code",[s._v("then")]),s._v(" 里面执行的结果")]),s._v("，又因为 "),n("code",[s._v("async")]),s._v(" 函数会返回 "),n("code",[s._v("promise")]),s._v(" 实例，所以还可以等效成 👇")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function test () {\n    console.log(5);\n    console.log(1);\n}\n\ntest()\n    .then(() => console.log(2))\n    .then(() => console.log(3))\n    .then(() => console.log(4))\n    .then(() => console.log(6))\n\nconsole.log(7);\n\nPromise.resolve()\n    .then(() => console.log(8))\n    .then(() => console.log(9))\n    .then(() => console.log(10))\n    .then(() => console.log(11));\n\n// 最终结果👉: 5 1 7 2 8 3 9 4 10 6 11\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("p",[s._v("可以发现，"),n("code",[s._v("test")]),s._v(" 函数全是走的同步代码...")]),s._v(" "),n("p",[s._v("所以 👉："),n("strong",[n("code",[s._v("async/await")]),s._v(" 是用同步的方式，执行异步操作")])]),s._v(" "),n("h2",{attrs:{id:"_3、🌰"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3、🌰"}},[s._v("#")]),s._v(" 3、🌰")]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("🌰1：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function async2 () {\n    new Promise((resolve, reject) => {\n        resolve()\n    })\n}\n\nasync function async3 () {\n    return new Promise((resolve, reject) => {\n        resolve()\n    })\n}\n\nasync function async1 () {\n    // 方式一：最终结果：B A C D\n    // await new Promise((resolve, reject) => {\n    //     resolve()\n    // })\n\n    // 方式二：最终结果：B A C D\n    // await async2()\n\n    // 方式三：最终结果：B C D A\n    await async3()\n\n    console.log('A')\n}\n\nasync1()\n\nnew Promise((resolve) => {\n    console.log('B')\n    resolve()\n}).then(() => {\n    console.log('C')\n}).then(() => {\n    console.log('D')\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("blockquote",[n("p",[s._v("大致思路 👇：")]),s._v(" "),n("ul",[n("li",[s._v("首先，"),n("strong",[n("code",[s._v("async")]),s._v("函数的整体返回值永远都是"),n("code",[s._v("Promise")]),s._v("，无论值本身是什么")])]),s._v(" "),n("li",[s._v("方式一："),n("code",[s._v("await")]),s._v("的是"),n("code",[s._v("Promise")]),s._v("，无需等待")]),s._v(" "),n("li",[s._v("方式二："),n("code",[s._v("await")]),s._v("的是"),n("code",[s._v("async")]),s._v("函数，但是该函数的返回值本身是"),n("strong",[s._v("非"),n("code",[s._v("thenable")])]),s._v("，无需等待")]),s._v(" "),n("li",[s._v("方式三："),n("code",[s._v("await")]),s._v("的是"),n("code",[s._v("async")]),s._v("函数，且返回值本身是"),n("code",[s._v("Promise")]),s._v("，需等待两个"),n("code",[s._v("then")]),s._v("时间")])])]),s._v(" "),n("p",[s._v("🌰2：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function func () {\n    console.log(2);\n\n    // 方式一：1 2 4  5 3 6 7\n    // Promise.resolve()\n    //     .then(() => console.log(5))\n    //     .then(() => console.log(6))\n    //     .then(() => console.log(7))\n\n    // 方式二：1 2 4  5 6 7 3\n    return Promise.resolve()\n        .then(() => console.log(5))\n        .then(() => console.log(6))\n        .then(() => console.log(7))\n}\n\nasync function test () {\n    console.log(1);\n    await func();\n    console.log(3);\n}\n\ntest();\nconsole.log(4);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("blockquote",[n("p",[s._v("步骤拆分 👇：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("方式一：")])]),s._v(" "),n("li",[n("ul",[n("li",[s._v("同步代码输出"),n("code",[s._v("1、2")]),s._v("，接着将"),n("code",[s._v("log(5)")]),s._v("处的"),n("code",[s._v("then1")]),s._v("加入微任务队列，"),n("code",[s._v("await")]),s._v("拿到确切的"),n("code",[s._v("func")]),s._v("函数返回值"),n("code",[s._v("undefined")]),s._v("，将后续代码放入微任务队列（"),n("code",[s._v("then2")]),s._v("，可以这样理解）")]),s._v(" "),n("li",[s._v("执行同步代码输出"),n("code",[s._v("4")]),s._v("，到此，所有同步代码完毕")]),s._v(" "),n("li",[s._v("执行第一个放入的微任务"),n("code",[s._v("then1")]),s._v("输出"),n("code",[s._v("5")]),s._v("，产生"),n("code",[s._v("log(6)")]),s._v("的微任务"),n("code",[s._v("then3")])]),s._v(" "),n("li",[s._v("执行第二个放入的微任务"),n("code",[s._v("then2")]),s._v("输出"),n("code",[s._v("3")])]),s._v(" "),n("li",[s._v("然后执行微任务"),n("code",[s._v("then3")]),s._v("，输出"),n("code",[s._v("6")]),s._v("，产生"),n("code",[s._v("log(7)")]),s._v("的微任务"),n("code",[s._v("then4")])]),s._v(" "),n("li",[s._v("执行"),n("code",[s._v("then4")]),s._v("，输出"),n("code",[s._v("7")])])])]),s._v(" "),n("li",[n("p",[s._v("方式二：")])]),s._v(" "),n("li",[n("ul",[n("li",[s._v("同步代码输出"),n("code",[s._v("1、2")]),s._v("，"),n("code",[s._v("await")]),s._v("拿到"),n("code",[s._v("func")]),s._v("函数返回值，但是并未获得"),n("strong",[s._v("具体的结果")]),s._v("（由"),n("code",[s._v("Promise")]),s._v("本身机制决定），暂停执行当前"),n("code",[s._v("async")]),s._v("函数内的代码（跳出、让行）")]),s._v(" "),n("li",[s._v("输出"),n("code",[s._v("4")]),s._v("，到此，所有同步代码完毕")]),s._v(" "),n("li",[n("code",[s._v("await")]),s._v("一直等到"),n("code",[s._v("Promise.resolve().then...")]),s._v("执行完成，再放行输出"),n("code",[s._v("3")])])])])])]),s._v(" "),n("p",[s._v("方式二没太明白 ❓")]),s._v(" "),n("p",[s._v("继续 👇")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function func () {\n    console.log(2);\n\n    return Promise.resolve()\n        .then(() => console.log(5))\n        .then(() => console.log(6))\n        .then(() => console.log(7))\n}\n\nasync function test () {\n    console.log(1);\n    await func()\n    console.log(3);\n}\n\ntest();\nconsole.log(4);\n\nnew Promise((resolve) => {\n    console.log('B')\n    resolve()\n}).then(() => {\n    console.log('C')\n}).then(() => {\n    console.log('D')\n})\n\n// 最终结果👉: 1 2 4    B 5 C 6 D 7 3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("p",[s._v("还是没懂？")]),s._v(" "),n("p",[s._v("继续 👇")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function test () {\n    console.log(1);\n    await Promise.resolve()\n        .then(() => console.log(5))\n        .then(() => console.log(6))\n        .then(() => console.log(7))\n    console.log(3);\n}\n\ntest();\nconsole.log(4);\n\nnew Promise((resolve) => {\n    console.log('B')\n    resolve()\n}).then(() => {\n    console.log('C')\n}).then(() => {\n    console.log('D')\n})\n\n// 最终结果👉: 1 4    B 5 C 6 D 7 3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("blockquote",[n("p",[s._v("Note:")]),s._v(" "),n("p",[s._v("综上，"),n("code",[s._v("await")]),s._v("一定要等到右侧的表达式有"),n("strong",[s._v("确切的值")]),s._v("才会放行，否则将一直等待（阻塞当前"),n("code",[s._v("async")]),s._v("函数内的后续代码），不服看看这个 👇")]),s._v(" "),n("ul",[n("li",[n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function func () {\n  return new Promise((resolve) => {\n      console.log('B')\n      // resolve() 故意一直保持pending\n  })\n}\n\nasync function test () {\n  console.log(1);\n  await func()\n  console.log(3);\n}\n\ntest();\nconsole.log(4);\n// 最终结果👉: 1 B 4 (永远不会打印3)\n\n\n// ---------------------或者写为👇-------------------\nasync function test () {\n  console.log(1);\n  await new Promise((resolve) => {\n      console.log('B')\n      // resolve() 故意一直保持pending\n  })\n  console.log(3);\n}\n\ntest();\nconsole.log(4);\n// 最终结果👉: 1 B 4 (永远不会打印3)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])])])])]),s._v(" "),n("p",[s._v("🌰3：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("async function func () {\n    console.log(2);\n    return {\n        then (cb) {\n            cb()\n        }\n    }\n}\n\nasync function test () {\n    console.log(1);\n    await func();\n    console.log(3);\n}\n\ntest();\nconsole.log(4);\n\nnew Promise((resolve) => {\n    console.log('B')\n    resolve()\n}).then(() => {\n    console.log('C')\n}).then(() => {\n    console.log('D')\n})\n\n// 最终结果👉: 1 2 4 B C 3 D\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("blockquote",[n("p",[s._v("步骤拆分 👇：")]),s._v(" "),n("ul",[n("li",[s._v("同步代码输出"),n("code",[s._v("1、2")])]),s._v(" "),n("li",[n("code",[s._v("await")]),s._v("拿到"),n("code",[s._v("func")]),s._v("函数的具体返回值"),n("code",[s._v("thenable")]),s._v("，将当前"),n("code",[s._v("async")]),s._v("函数内的后续代码放入微任务"),n("code",[s._v("then1")]),s._v("(但是需要等待一个"),n("code",[s._v("then")]),s._v("时间)")]),s._v(" "),n("li",[s._v("同步代码输出"),n("code",[s._v("4、B")]),s._v("，产生"),n("code",[s._v("log(C)")]),s._v("的微任务"),n("code",[s._v("then2")])]),s._v(" "),n("li",[s._v("由于"),n("code",[s._v("then1")]),s._v("滞后一个"),n("code",[s._v("then")]),s._v("时间，直接执行"),n("code",[s._v("then2")]),s._v("输出"),n("code",[s._v("C")]),s._v("，产生"),n("code",[s._v("log(D)")]),s._v("的微任务"),n("code",[s._v("then3")])]),s._v(" "),n("li",[s._v("执行原本滞后一个"),n("code",[s._v("then")]),s._v("时间的微任务"),n("code",[s._v("then1")]),s._v("，输出"),n("code",[s._v("3")])]),s._v(" "),n("li",[s._v("执行最后一个微任务"),n("code",[s._v("then3")]),s._v("输出"),n("code",[s._v("D")])])])]),s._v(" "),n("h2",{attrs:{id:"_4、总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4、总结"}},[s._v("#")]),s._v(" 4、总结")]),s._v(" "),n("hr"),s._v(" "),n("blockquote",[n("p",[n("code",[s._v("async")]),s._v("函数返回值")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("📑 结论："),n("code",[s._v("async")]),s._v("函数在抛出返回值时，会根据返回值"),n("strong",[s._v("类型")]),s._v("开启"),n("strong",[s._v("不同数目的微任务")])])]),s._v(" "),n("li",[n("ul",[n("li",[s._v("return 结果值：非"),n("code",[s._v("thenable")]),s._v("、非"),n("code",[s._v("promise")]),s._v("（不等待）")]),s._v(" "),n("li",[s._v("return 结果值："),n("code",[s._v("thenable")]),s._v("（等待 1 个"),n("code",[s._v("then")]),s._v("的时间）")]),s._v(" "),n("li",[s._v("return 结果值："),n("code",[s._v("promise")]),s._v("（等待 2 个"),n("code",[s._v("then")]),s._v("的时间）")])])])]),s._v(" "),n("p",[n("code",[s._v("await")]),s._v("右值类型区别")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("接非 "),n("code",[s._v("thenable")]),s._v(" 类型，会立即向微任务队列添加一个微任务"),n("code",[s._v("then")]),s._v("，"),n("strong",[s._v("但不需等待")])])]),s._v(" "),n("li",[n("p",[s._v("接 "),n("code",[s._v("thenable")]),s._v(" 类型，需要"),n("strong",[s._v("等待一个 "),n("code",[s._v("then")]),s._v(" 的时间之后")]),s._v("执行")])]),s._v(" "),n("li",[n("p",[s._v("接"),n("code",[s._v("Promise")]),s._v("类型(有确定的返回值)，会立即向微任务队列添加一个微任务"),n("code",[s._v("then")]),s._v("，"),n("strong",[s._v("但不需等待")])])]),s._v(" "),n("li",[n("ul",[n("li",[s._v("TC 39 对"),n("code",[s._v("await")]),s._v(" 后面是 "),n("code",[s._v("promise")]),s._v(" 的情况如何处理进行了一次修改，"),n("strong",[s._v("移除")]),s._v("了额外的两个微任务，在"),n("strong",[s._v("早期版本")]),s._v("，依然会等待两个 "),n("code",[s._v("then")]),s._v(" 的时间")])])])])]),s._v(" "),n("h3",{attrs:{id:"参考资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("[1]https://juejin.cn/post/6844903715342647310#heading-3: "),n("em",[s._v("https://juejin.cn/post/6844903715342647310#heading-3")])])])}),[],!1,null,null,null);n.default=t.exports}}]);